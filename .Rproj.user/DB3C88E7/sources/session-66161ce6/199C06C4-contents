```{=html}
<!-- === TEST SUBIDA (Base64 + iframe) === -->
<section class="card" id="uploader-test">
  <div class="card-body">
    <h3>Test de subida de adjunto</h3>
    <p>Base64 + POST cl√°sico a Apps Script.</p>

    <iframe name="uploadSink" id="uploadSink" style="display:none;"></iframe>

    <form id="base64UploadForm"
          action="https://script.google.com/macros/s/AKfycbzjs4U62U_MX4uijNtLduo3jONlOOObSrnTffhW_iwQB-RWMQ7UiRVEUER89ha0b0FTcQ/exec"
          method="POST" target="uploadSink" enctype="application/x-www-form-urlencoded">
      <div class="form-group">
        <label for="testFile">Adjunto de prueba (PDF/DOC/DOCX, ‚â§5 MB)</label>
        <input type="file" id="testFile" accept=".pdf,.doc,.docx">
      </div>

      <!-- Campos ocultos -->
      <input type="hidden" name="fileName"   id="fileName">
      <input type="hidden" name="fileData"   id="fileData">
      <input type="hidden" name="servicio"   value="TEST_BASE64">
      <input type="hidden" name="_formStart" id="_formStart">

      <div id="uploadStatus" class="upload-status" aria-live="polite">Ning√∫n archivo seleccionado.</div>
      <button type="submit" id="uploadBtn" class="btn btn-primary" disabled>Enviar adjunto de prueba</button>
    </form>
  </div>
</section>

<style>
.upload-status{margin-top:.5rem;font-size:.95rem}
.upload-status.ok{color:#1e7e34}
.upload-status.err{color:#b00020}
</style>

<script>
(function(){
  const form   = document.getElementById("base64UploadForm");
  const fileIn = document.getElementById("testFile");
  const fName  = document.getElementById("fileName");
  const fData  = document.getElementById("fileData");
  const start  = document.getElementById("_formStart");
  const sink   = document.getElementById("uploadSink");
  const status = document.getElementById("uploadStatus");
  const btn    = document.getElementById("uploadBtn");

  // Anti-bot: marcar inicio apenas carga
  if (start) start.value = new Date().toISOString();

  // Validaci√≥n simple
  fileIn.addEventListener("change", () => {
    const f = fileIn.files && fileIn.files[0];
    if (!f){ status.textContent="Ning√∫n archivo seleccionado."; btn.disabled=true; return; }
    const ext = (f.name.split(".").pop()||"").toLowerCase();
    if (!["pdf","doc","docx"].includes(ext)){
      status.textContent="‚ö†Ô∏è Formato no v√°lido. Sub√≠ PDF, DOC o DOCX.";
      fileIn.value=""; btn.disabled=true; return;
    }
    if (f.size > 5*1024*1024){
      status.textContent="‚ö†Ô∏è El archivo supera los 5 MB.";
      fileIn.value=""; btn.disabled=true; return;
    }
    status.innerHTML = `üìÑ Archivo: <strong>${f.name}</strong> (${(f.size/1024/1024).toFixed(2)} MB)`;
    btn.disabled=false;
  });

  form.addEventListener("submit", (e) => {
    const f = fileIn.files && fileIn.files[0];
    if (!f){ e.preventDefault(); status.textContent="‚ö†Ô∏è Seleccion√° un archivo."; return; }

    e.preventDefault(); // convertir antes de enviar
    status.innerHTML = `‚è≥ Subiendo <strong>${f.name}</strong>...`; btn.disabled=true;

    const reader = new FileReader();
    reader.onload = (ev)=>{
      try{
        const dataUrl = String(ev.target.result||"");
        const ix = dataUrl.indexOf(",");
        if (ix<0) throw new Error("DataURL inv√°lido");
        const base64 = dataUrl.slice(ix+1);
        fName.value  = f.name;
        fData.value  = base64;

        // Escuchar respuesta del iframe ANTES del submit
        const onLoad = ()=>{
          sink.removeEventListener("load", onLoad);
          status.innerHTML = `‚úÖ <strong>${f.name}</strong> enviado. Revis√° tu Drive/hoja.`;
          status.classList.remove("err"); status.classList.add("ok");
          btn.disabled=false;
        };
        sink.addEventListener("load", onLoad);

        form.submit();
      }catch(err){
        status.textContent = "‚ùå Error al preparar el archivo: " + err.message;
        status.classList.add("err"); btn.disabled=false;
      }
    };
    reader.onerror = ()=>{
      status.textContent = "‚ùå Error al leer el archivo.";
      status.classList.add("err"); btn.disabled=false;
    };
    reader.readAsDataURL(f);
  });
})();
</script>
```